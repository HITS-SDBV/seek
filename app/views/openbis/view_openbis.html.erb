<%
    project = @assay.openbis_project
    Seek::Openbis::ConnectionInfo.setup(project.openbis_username, project.openbis_password, project.openbis_endpoint)
%>

<%= render :partial=>"openbis/experiments",:object=>@experiments -%>

<% if @experiments.count==1
        @experiment=@experiments[0]
%>
    <%= form_tag add_openbis_stuff_assay_path(@assay),:method=>:post do %>
        <%= render :partial => 'openbis/samples', :object => @experiment.samples %>

        <%= submit_tag "Submit",:class => 'btn btn-primary' %>
    <% end %>
<% end %>

<script>
    $j(document).ready(function () {
        $j('.openbis-sample-title a').click(function () {
            $j(this).parents('.openbis-sample').find('.openbis-sample-body').slideToggle()
        });

        // If a dataset is selected, make sure its sample is selected too
        $j('.openbis-dataset input[type=checkbox]').change(function () {
            if(this.checked)
                $j(this).parents('.openbis-sample').find('.openbis-sample-title input[type=checkbox]').prop('checked', true);
        });
    });
</script>
