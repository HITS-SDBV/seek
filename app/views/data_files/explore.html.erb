<%= stylesheet_link_tag('spreadsheet_explorer', 'jquery.ui.resizable') %>
<%= javascript_include_tag 'jquery.ui.all','spreadsheet_explorer','spreadsheet_explorer_plot',
    'flot/index' %>


<div style="margin-left: auto; margin-right: auto; margin-top: 2em; width: 98%;">
  <div id="spreadsheet_errors"></div>
  <button id="applySelection">Apply Selection</button>
  <input size="50" id="selection_data">
  <input size="60" id="cell_info" readonly="readonly">

  <div class="spreadsheet_controls">
    <%= link_to image('destroy') + " Clear Selection", "#", :onclick =>"deselect_cells();$j('#cell_info').val(''); return false;",
    :title => "Cancel the current selection", :class => "spreadsheet_button requires_selection" %>
    <%= link_to image('spreadsheet') + " List Annotations", "#", :onclick =>"$j('div.spreadsheet_popup').hide(); $j('div#annotation_overview').show();return false;",
    :title => "Add new annotation", :class => "spreadsheet_button" %>
    <% if logged_in? %>
    <%= link_to image('spreadsheet_annotation_add') + " Add Annotation", "#", :onclick =>"$j('div.spreadsheet_popup').hide(); $j('div#annotation_form').show();return false;",
    :title => "Add new annotation", :class => "spreadsheet_button requires_selection" %>
    <% end %>
    <%= link_to image('spreadsheet_export') + " Export Data", "#", :onclick =>"copy_cells(); return false;",
    :title => "Export selected cells into an external application", :class => "spreadsheet_button requires_selection" %>
    <%= link_to image('graph') + " Plot Data", "#", :onclick =>"plot_selected_cells('plot_data','620','400'); return false;",
    :title => "XNY plot of the data", :class => "spreadsheet_button requires_selection" %>
    <div class="spreadsheet_button">
      <div class="dropdown" id="browse-menu">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
          <span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span>
          <span class="hidden-md">Analyze</span>
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
          <li role="presentation" class="dropdown-header visible-md">Browse</li>
          <li role="presentation" class="dropdown-header">Simple statistical tests</li>

          <% Settings.defaults[:python_nb_notebooks].each do |notebook| %>
            <% unless notebook['display_name'].nil? %>
              <li>
                <%
                  call_id = notebook["id"]
                  call_text = "intermediate_analysis_menu('" + call_id + "', '" + notebook['display_name'] +"')"
                %>
                <a onclick="<%= call_text%>">
                  <%= notebook['display_name']%>
                </a>
              </li>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <div class="spreadsheet_viewer" id="spreadsheet_outer_frame">
    <%= render :partial => "spreadsheets/annotation_form" %>
    <%= render :partial => "spreadsheets/export" %>
    <%= render :partial => "spreadsheets/plot" %>
    <%= render :partial => "spreadsheet_analysis/default_form" %>
    <%= render :partial => "spreadsheets/python_nb" %>

    <div id="annotations">
      <%= render :partial => "spreadsheets/annotations", :locals=>{ :annotations => @display_data_file.spreadsheet_annotations } %>
    </div>

    <%
       spreadsheet = Rails.cache.fetch(@display_data_file.content_blob.cache_key) do
       @display_data_file.spreadsheet
       end
       %>
    <%= render :partial => "spreadsheets/spreadsheet_styles", :locals => {:styles => spreadsheet.styles} %>
    <%= render :partial => "spreadsheets/spreadsheet", :locals => {:workbook => spreadsheet }%>

  </div>
</div>
